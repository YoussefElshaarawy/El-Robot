<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>Warhol 5 — Fixed Composer (iPhone‑optimised)</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Recursive:opsz,wdth,wght,slnt,CASL@14..32,75..100,400..800,-15..0,0..1&display=swap" rel="stylesheet">
<style>
  :root{
    --bg1:#f3c7b9; --bg2:#ffe3b9; --bg3:#e9e5ff; --bg4:#dfe9ff;
    --surface:#fff; --border: rgba(2,6,23,.10); --text:#0b1324; --muted:#475569;
    --chip:#f5f7fb; --sidebar:#f7f8fb;
    --shadow: 0 8px 24px rgba(2,6,23,.10), 0 1px 2px rgba(2,6,23,.06);
  }
  *{box-sizing:border-box}
  html,body{height:100%;}
  body{
    margin:0;
    font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    color:var(--text);
    background:
      radial-gradient(36% 40% at 22% 25%, var(--bg1) 0%, rgba(0,0,0,0) 60%),
      radial-gradient(40% 45% at 78% 30%, var(--bg2) 0%, rgba(0,0,0,0) 65%),
      radial-gradient(55% 55% at 20% 85%, var(--bg3) 0%, rgba(0,0,0,0) 70%),
      radial-gradient(60% 60% at 80% 85%, var(--bg4) 0%, rgba(0,0,0,0) 70%),
      #f6f7fb;
    background-attachment: fixed;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  /* Layout */
  .app{ display:grid; grid-template-columns: 64px 1fr; min-height:100svh; min-height:100dvh; }
  .sidebar{ border-right:1px solid rgba(2,6,23,.06); padding:8px 8px; background: linear-gradient(180deg, #fff, #f9fbff); }
  .side-item{
    width:44px;height:44px;border-radius:12px;
    display:grid;place-items:center;margin:10px auto;
    background:var(--sidebar); border:1px solid rgba(2,6,23,.06);
    box-shadow: inset 0 1px 0 rgba(255,255,255,.6);
    cursor:pointer; transition: transform .06s ease;
    touch-action: manipulation;
  }
  .side-item:hover{ transform: translateY(-1px) }
  .side-item svg{ width:18px;height:18px; opacity:.85 }

  .main{ position:relative; display:flex; flex-direction:column; min-height:100%; }
  .brand{
    position:absolute; top:12px; left:16px; display:flex; align-items:center; gap:10px;
    font-family:"Recursive", Inter, system-ui; font-variation-settings:"CASL" .6, "wdth" 90, "wght" 720, "slnt" 0;
    letter-spacing:-.01em;
  }
  .brand strong{ font-variation-settings:"CASL" .5, "wdth" 86, "wght" 800 }

  /* Scroll area (hero + chat) */
  .scroll{ flex:1 1 auto; overflow:auto; padding:24px 16px calc(180px + env(safe-area-inset-bottom)); /* space for composer */ }
  .hero{ min-height:55vh; display:grid; place-items:center; }
  .center{ text-align:center; max-width:760px; margin:0 auto; }
  h1{
    margin:0 0 8px; font-family:"Recursive", Inter, system-ui;
    font-variation-settings:"CASL" .7, "wdth" 88, "wght" 780, "slnt" -3; font-size:clamp(22px, 5vw, 32px);
  }
  .subtitle{ margin:0 auto 26px; max-width:560px; font-size:15px; line-height:1.6; color:var(--muted) }

  .chat{ max-width:860px; margin:0 auto; display:none; }
  .msg{ display:flex; gap:12px; margin:18px 0; align-items:flex-start }
  .avatar{ flex:0 0 32px; width:32px;height:32px;border-radius:8px; display:grid;place-items:center;
    background:#111827; color:#fff; font-weight:700; font-size:12px;}
  .assistant{ background:#1e293b }
  .bubble{
    background:#ffffffcc; backdrop-filter: blur(6px);
    border:1px solid rgba(2,6,23,.08);
    padding:12px 14px; border-radius:14px;
    box-shadow: 0 4px 14px rgba(2,6,23,.06);
    max-width: 90%;
  }
  .loading{ font-family:"Recursive", Inter; font-variation-settings:"CASL" .5, "wdth" 95, "wght" 600, "slnt" -4; }
  .loading .dots{ display:inline-block; width:24px; text-align:left }
  .loading .dots::after{ content:"…"; animation: ellipsis 1.2s infinite steps(3,end); }
  @keyframes ellipsis{ 0%{content:"";} 33%{content:".";} 66%{content:"..";} 100%{content:"...";} }

  /* Composer fixed at bottom, always visible */
  .composer-wrap{
    position:fixed; left:64px; right:0; bottom: max(16px, env(safe-area-inset-bottom)); z-index:30;
    display:grid; place-items:center; pointer-events:none; transition: transform .2s ease;
  }
  .composer{
    pointer-events:all;
    display:flex; align-items:center; gap:10px;
    width:min(760px, 92vw);
    background:var(--surface); border:1px solid var(--border);
    border-radius:999px; padding:10px 12px; box-shadow:var(--shadow);
  }
  .chip{ width:40px;height:40px;border-radius:999px; display:grid;place-items:center;
    border:1px solid rgba(2,6,23,.10); background:#f3f5f9; cursor:pointer; }
  .chip svg{ width:16px;height:16px; opacity:.9 }
  .plus{ background:#eef2f6 }
  .input{ flex:1; display:flex; align-items:center}
  /* Prevent iOS zoom-on-focus: keep >=16px */
  .input input{ width:100%; border:none; outline:none; font-size:16px; padding:10px 6px; background:transparent; }

  /* Card + lightbox */
  .card{ width: min(560px, 92vw); aspect-ratio:1/1; background:#fff; border:1px solid rgba(2,6,23,.08);
    border-radius:16px; overflow:hidden; box-shadow:0 20px 50px rgba(2,6,23,.2), 0 2px 6px rgba(2,6,23,.08);
    margin-top:12px; cursor:zoom-in; }
  .card img{ width:100%; height:100%; object-fit:cover; display:block }
  .caption{ font-size:12px; color:#334155; margin-top:6px }

  .lightbox{ position:fixed; inset:0; background:rgba(2,6,23,.7); display:none; align-items:center; justify-content:center; padding:24px; z-index:60; }
  .lightbox img{ max-width:92vw; max-height:92vh; border-radius:18px; box-shadow: 0 30px 80px rgba(0,0,0,.5); }
  .lightbox:focus{ outline:none }

  /* Drawer (assets) */
  .drawer{ position:fixed; top:0; right:-420px; width:420px; max-width:92vw; height:100%;
    background:#fff; border-left:1px solid rgba(2,6,23,.08); box-shadow:-20px 0 60px rgba(2,6,23,.18);
    transition:right .28s ease; padding:18px; display:flex; flex-direction:column; gap:12px; z-index:50; }
  .drawer.open{ right:0; }
  .dropzone{ padding:18px; border:2px dashed rgba(2,6,23,.15); border-radius:14px; background:#f8fafc; text-align:center }
  .dropzone.drag{ border-color:#0ea5e9; background:#eef6ff; }
  .thumbs{ display:grid; grid-template-columns:repeat(3,1fr); gap:10px; overflow:auto }
  .thumb{ position:relative; border:1px solid rgba(2,6,23,.1); border-radius:10px; overflow:hidden; background:#fff }
  .thumb img{ width:100%; height:100%; object-fit:cover; aspect-ratio:1/1 }
  .thumb .idx{ position:absolute; top:6px; left:6px; background:#111827; color:#fff; font-size:11px; padding:2px 6px; border-radius:999px }
  .thumb .rm{ position:absolute; top:6px; right:6px; background:#fff; border:1px solid rgba(2,6,23,.2); border-radius:8px; padding:0 6px; font-size:12px; cursor:pointer }
  .controls{ display:flex; gap:8px }
  .btn{ border:1px solid rgba(2,6,23,.12); background:#fff; border-radius:10px; padding:10px 12px; cursor:pointer; font-size:14px }
  .btn.primary{ background:#0ea5e9; color:#fff; border-color:#0ea5e9 }

  /* Mobile tweaks */
  @media (max-width:720px){
    .app{ grid-template-columns:56px 1fr }
    .composer-wrap{ left:56px }
    .thumbs{ grid-template-columns:repeat(2,1fr) }
    .subtitle{ font-size:14px }
  }
  @media (max-width:420px){
    .brand{ top:10px; left:12px; font-size:14px }
    .composer{ width:min(720px, 94vw); }
  }

  /* When keyboard opens and we shift the composer using visualViewport */
  .kb-open .composer-wrap{ transform: translateY(-12px); }
</style>
</head>
<body>
<div class="app">
  <aside class="sidebar">
    <div class="side-item" id="btnNew" title="New session">
      <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 5v14M5 12h14" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round"/></svg>
    </div>
    <div class="side-item" id="btnAssets" title="Hidden assets">
      <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M4 6h16v12H4z" fill="none" stroke="currentColor" stroke-width="1.4"/><path d="M4 10h16" stroke="currentColor" stroke-width="1.4"/></svg>
    </div>
  </aside>

  <main class="main">
    <div class="brand">Warhol <strong style="margin-left:6px">5</strong></div>

    <div class="scroll" id="scroll">
      <section class="hero" id="hero">
        <div class="center">
          <h1>Introducing Warhol&nbsp;5</h1>
          <p class="subtitle">Warhol now has our smartest, fastest, most useful model yet, with thinking built in — so you get the best answer, every time.</p>
        </div>
      </section>

      <section class="chat" id="chat" aria-live="polite">
        <div class="msg">
          <div class="avatar assistant">W5</div>
          <div class="bubble">Open the drawer to add images. Then type a prompt. I’ll show <em>Generating…</em> and reveal the next image in order.</div>
        </div>
        <div id="thread"></div>
      </section>
    </div>

    <!-- Composer fixed bottom -->
    <div class="composer-wrap" id="composerWrap">
      <div class="composer" role="form" aria-label="Message composer">
        <button class="chip plus" title="Starter" aria-label="Starter action">
          <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 5v14M5 12h14" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/></svg>
        </button>
        <label class="input" for="prompt" style="display:flex; align-items:center; gap:6px;">
          <input id="prompt" placeholder="Ask anything — each message reveals the next queued image" aria-label="Ask anything" autocomplete="off" inputmode="text"/>
        </label>
        <button class="chip" id="btnAssets2" title="Assets" aria-label="Open assets drawer">
          <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M4 6h16v12H4z" fill="none" stroke="currentColor" stroke-width="1.4"/><path d="M4 10h16" stroke="currentColor" stroke-width="1.4"/></svg>
        </button>
      </div>
    </div>
  </main>
</div>

<!-- Drawer -->
<div class="drawer" id="drawer" aria-hidden="true" aria-label="Hidden assets drawer">
  <h3>Hidden Assets</h3>
  <div class="dropzone" id="dropzone">Drop images here or tap to choose</div>
  <input type="file" id="fileInput" accept="image/*" multiple style="display:none"/>
  <div class="controls">
    <button class="btn" id="btnClear">Clear</button>
    <button class="btn primary" id="btnCloseDrawer">Done</button>
  </div>
  <div class="thumbs" id="thumbs"></div>
</div>

<!-- Lightbox -->
<div class="lightbox" id="lightbox" tabindex="-1" role="dialog" aria-modal="true">
  <img alt="Enlarged artwork"/>
</div>

<script>
  const elPrompt = document.getElementById('prompt');
  const hero = document.getElementById('hero');
  const chat = document.getElementById('chat');
  const thread = document.getElementById('thread');
  const scrollArea = document.getElementById('scroll');
  const composerWrap = document.getElementById('composerWrap');

  // Drawer
  const drawer = document.getElementById('drawer');
  const btnAssets = document.getElementById('btnAssets');
  const btnAssets2 = document.getElementById('btnAssets2');
  const btnCloseDrawer = document.getElementById('btnCloseDrawer');
  const dropzone = document.getElementById('dropzone');
  const fileInput = document.getElementById('fileInput');
  const thumbs = document.getElementById('thumbs');
  const btnClear = document.getElementById('btnClear');

  // Lightbox
  const lightbox = document.getElementById('lightbox');
  const lbImg = lightbox.querySelector('img');

  // Image queue
  const queue = [];
  let cursor = 0;

  function openDrawer(){ drawer.classList.add('open'); drawer.setAttribute('aria-hidden','false'); }
  function closeDrawer(){ drawer.classList.remove('open'); drawer.setAttribute('aria-hidden','true'); }
  btnAssets.onclick = openDrawer;
  btnAssets2.onclick = openDrawer;
  btnCloseDrawer.onclick = closeDrawer;

  dropzone.onclick = ()=> fileInput.click();
  fileInput.onchange = (e)=> handleFiles(e.target.files);

  ;['dragenter','dragover'].forEach(evt=> dropzone.addEventListener(evt, (e)=>{ e.preventDefault(); e.stopPropagation(); dropzone.classList.add('drag'); }));
  ;['dragleave','drop'].forEach(evt=> dropzone.addEventListener(evt, (e)=>{ e.preventDefault(); e.stopPropagation(); dropzone.classList.remove('drag'); }));
  dropzone.addEventListener('drop', (e)=>{ handleFiles(e.dataTransfer.files); });

  function handleFiles(files){
    const arr = Array.from(files).filter(f=> /^image\//.test(f.type));
    arr.forEach(f=>{
      const url = URL.createObjectURL(f);
      queue.push({name:f.name, url});
    });
    renderThumbs();
  }

  function renderThumbs(){
    thumbs.innerHTML='';
    queue.forEach((item, i)=>{
      const el = document.createElement('div');
      el.className = 'thumb';
      el.draggable = true;
      el.dataset.index = i;
      el.innerHTML = `<img src="${item.url}" alt=""><div class="idx">${i+1}</div><button class="rm" title="Remove">×</button>`;
      el.querySelector('.rm').onclick = ()=>{ queue.splice(i,1); if(cursor>i) cursor--; renderThumbs(); };
      el.addEventListener('dragstart', (e)=>{ e.dataTransfer.setData('text/plain', i.toString()); });
      el.addEventListener('dragover', (e)=>{ e.preventDefault(); });
      el.addEventListener('drop', (e)=>{
        e.preventDefault();
        const from = parseInt(e.dataTransfer.getData('text/plain'),10);
        const to = i;
        if(from===to) return;
        const [m] = queue.splice(from,1);
        queue.splice(to,0,m);
        if(cursor===from) cursor = to;
        renderThumbs();
      });
      thumbs.appendChild(el);
    });
  }

  btnClear.onclick = ()=>{
    queue.splice(0, queue.length);
    cursor = 0;
    renderThumbs();
  };

  function addMsg(role, html){
    const msg = document.createElement('div');
    msg.className = 'msg';
    const avatar = document.createElement('div');
    avatar.className = 'avatar ' + (role==='assistant' ? 'assistant' : '');
    avatar.textContent = role==='assistant' ? 'W5' : 'You';
    const bubble = document.createElement('div');
    bubble.className = 'bubble';
    bubble.innerHTML = html;
    msg.append(avatar, bubble);
    thread.appendChild(msg);
    chat.style.display='block';
    // Scroll to bottom of conversation (not the page)
    scrollArea.scrollTo({top: scrollArea.scrollHeight, behavior:'smooth'});
    return bubble;
  }

  function showGenerating(){
    return addMsg('assistant', `<span class="loading">Generating<span class="dots"></span></span>`);
  }

  function showNextImage(){
    if(cursor >= queue.length){
      addMsg('assistant', 'No queued images left. Open the drawer to add more.');
      return;
    }
    const item = queue[cursor++];
    const wrap = document.createElement('div');
    const card = document.createElement('div');
    card.className = 'card';
    const img = document.createElement('img');
    img.alt = item.name; img.src = item.url;
    card.appendChild(img);
    wrap.appendChild(card);
    const cap = document.createElement('div'); cap.className = 'caption'; cap.textContent = item.name; wrap.appendChild(cap);
    const bubble = addMsg('assistant', ''); bubble.appendChild(wrap);

    card.addEventListener('click', ()=>{ lbImg.src = item.url; lightbox.style.display='flex'; lightbox.focus(); });
  }

  lightbox.addEventListener('click', (e)=>{ if(e.target===lightbox){ lightbox.style.display='none'; lbImg.src=''; } });
  lightbox.addEventListener('keydown', (e)=>{ if(e.key==='Escape'){ lightbox.style.display='none'; lbImg.src=''; } });

  elPrompt.addEventListener('keydown', (e)=>{
    if(e.key === 'Enter'){
      const v = elPrompt.value.trim();
      if(!v) return;
      hero.style.display='none';
      chat.style.display='block';
      addMsg('user', v);

      const loading = showGenerating();

      setTimeout(()=>{
        loading.innerHTML = ' ';
        showNextImage();
      }, 900);

      elPrompt.value='';
    }
  });

  document.getElementById('btnNew').onclick = ()=>{
    thread.innerHTML='';
    chat.style.display='none';
    hero.style.display='grid';
    cursor = 0;
    scrollArea.scrollTop = 0;
    elPrompt.focus();
  };

  // iOS keyboard handling: keep composer visible and avoid layout jumps
  // Uses Visual Viewport API (supported on iOS Safari 13+)
  if (window.visualViewport) {
    const onVVChange = () => {
      const vv = window.visualViewport;
      if(!vv) return;
      const bottomOffset = Math.max(16, (window.innerHeight - (vv.height + vv.offsetTop)) + 16);
      // Reserve space when keyboard overlaps
      composerWrap.style.bottom = `calc(${bottomOffset}px + env(safe-area-inset-bottom))`;
      document.body.classList.toggle('kb-open', vv.height < window.innerHeight * 0.9);
      // Keep the input visible
      scrollArea.scrollTo({ top: scrollArea.scrollHeight });
    };
    visualViewport.addEventListener('resize', onVVChange);
    visualViewport.addEventListener('scroll', onVVChange);
  }

  // Focus management: ensure composer remains accessible
  elPrompt.addEventListener('focus', ()=>{
    setTimeout(()=>{ scrollArea.scrollTo({ top: scrollArea.scrollHeight, behavior: 'smooth' }); }, 50);
  });
</script>
</body>
</html>
